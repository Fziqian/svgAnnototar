<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="borderbox">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <title>Demo</title>
    <link href="https://cdn.bootcss.com/bootstrap/2.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>

        .demo {
            max-height: 100vh;
            /*overflow: scroll;*/
        }

        .svgContainer {
            display: inline-block;
            font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            font-weight: normal;
            font-size: 14px;
            max-width: 1000px;
            /* max-height:500px;    */
            /* overflow: scroll; */
        }
        text tspan{
            font-size: 16px;
        }

    </style>

</head>

<body>
    <div id="demo">
        <div class="svgContainer" id="svgContainer"></div>
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="labelCategoriesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        模态框（Modal）标题
                    </h4>
                </div>
                <div class="modal-body">
                    <select class="form-control" id="labelCatSel">
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" id="submitLabelCat" class="btn btn-primary">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="connectionCategoriesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="H1">
                        模态框（Modal）标题
                    </h4>
                </div>
                <div class="modal-body">
                    <select class="form-control" id="curConnectionSel">

                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" id="submitConnectionCat" class="btn btn-primary">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/2.3.1/js/bootstrap.min.js"></script>
<script src="../dist/Case-SvgAnnotator.js"></script>
<script type="text/javascript">
    var originString = "hello world";
    var str =`{
    "content": "查体，浅表淋巴结无肿大，心肺正常。腹平软，上腹部有轻度压痛，无反跳痛，无包块，肠鸣音正常。",
    "labelCategories": [
        {
            "id": 0,
            "text": "疾病和诊断",
            "color": "#ff8888",
            "borderColor": "#965f3f",
            "attributes": {
                "code": "disease",
                "assertTypeNo": 1
            }
        },
        {
            "id": 1,
            "text": "症状和体征",
            "color": "#fdb2e1",
            "borderColor": "#000080",
            "attributes": {
                "code": "symptom",
                "assertTypeNo": 0
            }
        },
        {
            "id": 2,
            "text": "身体部位",
            "color": "#6dd5fd",
            "borderColor": "#613C9D",
            "attributes": {
                "code": "body",
                "assertTypeNo": 0
            }
        },
        {
            "id": 3,
            "text": "检查和检验",
            "color": "#ffc36b",
            "borderColor": "#965f3f",
            "attributes": {
                "code": "check",
                "assertTypeNo": 0
            }
        },
        {
            "id": 4,
            "text": "治疗",
            "color": "#00ff00",
            "borderColor": "#965f3f",
            "attributes": {
                "code": "treatment",
                "assertTypeNo": 1
            }
        }
    ],
    "labels": [
        {
            "id": 0,
            "categoryId": 0,
            "startIndex": 6,
            "endIndex": 8,
            "attributes": {
                "assertTypeCode": "present",
                "unsureness": false,
                "signUser": "a"
            }
        },
        {
            "id": 1,
            "categoryId": 1,
            "startIndex": 12,
            "endIndex": 14,
            "attributes": {
                "assertTypeCode": null,
                "unsureness": false,
                "signUser": "a"
            }
        },
        {
            "id": 2,
            "categoryId": 1,
            "startIndex": 0,
            "endIndex": 2,
            "attributes": {
                "assertTypeCode": null,
                "unsureness": false,
                "signUser": "a"
            }
        }
    ],
    "connectionCategories": [
        {
            "id": 0,
            "text": "治疗改善了疾病",
            "attributes": {
                "relationRuleCode": "Tr2D",
                "code": "TrID"
            }
        },
        {
            "id": 1,
            "text": "治疗恶化了疾病",
            "attributes": {
                "relationRuleCode": "Tr2D",
                "code": "TrWD"
            }
        },
        {
            "id": 2,
            "text": "治疗导致了疾病",
            "attributes": {
                "relationRuleCode": "Tr2D",
                "code": "TrCD"
            }
        },
        {
            "id": 3,
            "text": "治疗施加于疾病",
            "attributes": {
                "relationRuleCode": "Tr2D",
                "code": "TrAD"
            }
        },
        {
            "id": 4,
            "text": "因为疾病而没有采取治疗",
            "attributes": {
                "relationRuleCode": "Tr2D",
                "code": "TrNAD"
            }
        },
        {
            "id": 5,
            "text": "治疗改善了症状",
            "attributes": {
                "relationRuleCode": "Tr2S",
                "code": "TrIS"
            }
        },
        {
            "id": 6,
            "text": "治疗恶化了症状",
            "attributes": {
                "relationRuleCode": "Tr2S",
                "code": "TrWS"
            }
        },
        {
            "id": 7,
            "text": "治疗导致了症状",
            "attributes": {
                "relationRuleCode": "Tr2S",
                "code": "TrCS"
            }
        },
        {
            "id": 8,
            "text": "治疗施加于症状",
            "attributes": {
                "relationRuleCode": "Tr2S",
                "code": "TrAS"
            }
        },
        {
            "id": 9,
            "text": "因为症状而没有采取治疗",
            "attributes": {
                "relationRuleCode": "Tr2S",
                "code": "TrNAS"
            }
        },
        {
            "id": 10,
            "text": "检查证实了疾病",
            "attributes": {
                "relationRuleCode": "Ch2D",
                "code": "ChRD"
            }
        },
        {
            "id": 11,
            "text": "为了证实疾病而采取检查",
            "attributes": {
                "relationRuleCode": "Ch2D",
                "code": "ChCD"
            }
        },
        {
            "id": 12,
            "text": "检查证实了症状",
            "attributes": {
                "relationRuleCode": "Ch2S",
                "code": "ChRS"
            }
        },
        {
            "id": 13,
            "text": "因为症状而采取检查",
            "attributes": {
                "relationRuleCode": "Ch2S",
                "code": "ChAS"
            }
        },
        {
            "id": 14,
            "text": "疾病导致了症状",
            "attributes": {
                "relationRuleCode": "D2S",
                "code": "DCS"
            }
        },
        {
            "id": 15,
            "text": "症状表明了疾病",
            "attributes": {
                "relationRuleCode": "D2S",
                "code": "SID"
            }
        },
        {
            "id": 16,
            "text": "身体部位患了疾病",
            "attributes": {
                "relationRuleCode": "B2D",
                "code": "DeAB"
            }
        },
        {
            "id": 17,
            "text": "身体部位没有患疾病",
            "attributes": {
                "relationRuleCode": "B2D",
                "code": "DeMB"
            }
        },
        {
            "id": 18,
            "text": "疾病在身体部位转移了",
            "attributes": {
                "relationRuleCode": "B2D",
                "code": "BoMD"
            }
        },
        {
            "id": 19,
            "text": "身体部位的疾病加重了",
            "attributes": {
                "relationRuleCode": "B2D",
                "code": "DeIB"
            }
        },
        {
            "id": 20,
            "text": "身体部位的疾病减轻了",
            "attributes": {
                "relationRuleCode": "B2D",
                "code": "DeDB"
            }
        },
        {
            "id": 21,
            "text": "身体部位的疾病痊愈了",
            "attributes": {
                "relationRuleCode": "B2D",
                "code": "DeMB"
            }
        },
        {
            "id": 22,
            "text": "身体部位出现了症状",
            "attributes": {
                "relationRuleCode": "B2S",
                "code": "BoAS"
            }
        },
        {
            "id": 23,
            "text": "身体部位没有出现症状",
            "attributes": {
                "relationRuleCode": "B2S",
                "code": "BoNS"
            }
        },
        {
            "id": 24,
            "text": "身体部位的症状减轻了",
            "attributes": {
                "relationRuleCode": "B2S",
                "code": "BoDS"
            }
        },
        {
            "id": 25,
            "text": "身体部位的症状加重了",
            "attributes": {
                "relationRuleCode": "B2S",
                "code": "BoIS"
            }
        },
        {
            "id": 26,
            "text": "身体部位的症状消失了",
            "attributes": {
                "relationRuleCode": "B2S",
                "code": "BoMS"
            }
        },
        {
            "id": 27,
            "text": "身体部位做了检查",
            "attributes": {
                "relationRuleCode": "B2C",
                "code": "BoAC"
            }
        },
        {
            "id": 28,
            "text": "身体部位未做检查",
            "attributes": {
                "relationRuleCode": "B2C",
                "code": "BoNC"
            }
        }
    ],
    "connections": [
        {
            "id": 0,
            "categoryId": 14,
            "fromId": 0,
            "toId": 1
        },
        {
            "id": 1,
            "categoryId": 14,
            "fromId": 2,
            "toId": 0
        }
    ]
}`;
var obj=JSON.parse(str)

    function bindSelHtml() {
        var labelHtml = "";
        for (var i = 0; i < obj.labelCategories.length; i++) {
            labelHtml += '<option value="' + obj.labelCategories[i].id + '">' + obj.labelCategories[i].text +
                '</option>';
        }
        $("#labelCatSel").html(labelHtml);

        var labelCatHtml = "";
        for (var i = 0; i < obj.connectionCategories.length; i++) {
            labelCatHtml += '<option value="' + obj.connectionCategories[i].id + '">' + obj.connectionCategories[i].text +
                '</option>';
        }
        $("#curConnectionSel").html(labelCatHtml);
    }


    bindSelHtml();
    var contentFiltered=obj.content.replace(/[ \u3000]+/g," ");

    var segContainer = document.getElementById("svgContainer");
    var an = $.SvgAnnotator(segContainer, obj, {
        allowMultipleLabel: false,
        maxLineWidth: 50,
        textSelected: function (startIndex, endIndex) {

            $("#labelCategoriesModal").modal("show");

            $("#submitLabelCat").off("click").on("click", function () {

                var curLabelCatId = $("#labelCatSel").val();
                an.createLabel(parseInt(curLabelCatId), startIndex, endIndex);
                console.log(contentFiltered.slice(startIndex,endIndex))
                $("#labelCategoriesModal").modal("hide");
            });
        },
        labelClicked: function (id) {
            //
        },
        twoLabelsClicked: function (first, second) {
            $("#connectionCategoriesModal").modal("show");

            $("#submitConnectionCat").off("click").on("click", function () {
                var curConnectionCatId = $("#curConnectionSel").val();
                an.createConnection(parseInt(curConnectionCatId), first, second);
                $("#connectionCategoriesModal").modal("hide");
            });
        },
        labelRightClicked: function (id, x, y) {
            an.deleteLabel(id);
        },
        connectionRightClicked: function (id, x, y) {
            an.deleteConnection(id);
        }
    });
</script>

</html>